# 系统规划

## 登录系统

### 登录方式

- 账号密码（仅供测试）
- 微信(`openId`+`UnionId`)

### 模块结构

- 逻辑处理放在 `service/sign` 目录下，每种方式独立一个service
    - `servAccount` 账号密码
    - `servWexin` 微信授权
    
## 课程准备

- 讲师发布课程
- 学员查看购买

## 支付系统

### 业务流程

- 购买
    - 学员选定课程
    - 生成订单，并分配听课名额
    - 学员完成支付（微信支付）
- 退款
    - 课程过期未使用/结束一小时内申请退款
    - 全款原路返回

## 授课系统

### IM群组授课

基于腾讯云通信，分讲师授课区和学员讨论区

授课区

- 图文语音，形式类似微信群
- 所有人接受，学员不能发言

讨论区

- 仅支持文字
- 学员自由讨论，可以提问
- 讲师可以在授课区回答学员的提问

课堂管理

- 学员列表
- 禁言

课程存档

- 课程结束后，授课记录需要转存到自己的云存储
- 以后考虑开放课程回放

### 视频直播授课

后续添加

## 渠道分发

- 讲师可以推广自己的课程，由此而来的收益全部归讲师所有
- 平台可以推广讲师的课程，由此而来的收益和讲师比例分成

## 数据统计

- 分渠道的收益结算
- 每日、周、月的分析汇总

## 事件触发

- 讲师开课提醒
	- 触发：开课前15分钟，且课程处于报名状态
	- 设置：课程审核通过时设置
	- 执行：向讲师发送提醒通知	
	- 解除：课程变更到非报名状态
- 讲师暂时离开
	- 触发：讲师最后发言超过15分钟，且课堂仍处在直播状态
	- 设置：发言后重置
	- 执行：向直播间群发系统消息
	- 解除：授课结束或进入课后交流
- 授课异常终止
	- 触发：讲师开课后或最后发言超过1小时，且课堂仍处在直播状态时
	- 设置：发言后重置
	- 执行：向直播间群发系统消息
	- 解除：授课结束或进入课后交流
- 讲师未按时开课
	- 触发：开课迟到15分钟，且课程处于报名状态
	- 设置：课程审核通过时设置
	- 执行：课程下架，向已报名学员发送提醒通知
	- 解除：课程变更到非报名状态
- 课程结束
	- 触发：课后交流时限到期
	- 设置：讲师开启课后交流状态
	- 执行：关闭直播间，开启课程回放
	- 解除：课程变更到非交流状态
- 未听课自动退款
	- 触发：讲师开课后24小时
	- 设置：讲师开课时触发
	- 执行：未听课学员退款，并将学员-课程状态重置
	- 解除：无
- 自由退款提醒
	- 触发：付费报名的学员首次进入课程后55分钟
	- 设置：付费报名的学员首次进入课程时
	- 执行：在直播间向对应学员发送系统提醒
	- 解除：学员确认付款
- 自由退款失效
	- 触发：付费报名的学员首次进入课程后60分钟
	- 设置：付费报名的学员首次进入课程时
	- 执行：默认该学员确认付款
	- 解除：学员确认付款
